{"id":"07957f4c-1a82-4e74-8811-8dc822195319","name":"ot-ob-rw-1-intake-file-qa-def","description":"Move file sent from local banks (NFS) to raw unformatted (HDFS)","settings":{"global":{"executionMode":"marathon","userPluginsJars":[],"preExecutionSqlSentences":[],"postExecutionSqlSentences":[],"addAllUploadedPlugins":true,"mesosConstraint":"spark:true","mesosConstraintOperator":"LIKE","parametersLists":["Environment"],"parametersUsed":["COUNTRY","DATE","Global.SPARK_CORES_MAX","Global.SPARK_DRIVER_CORES","Global.SPARK_DRIVER_JAVA_OPTIONS","Global.SPARK_DRIVER_MEMORY","Global.SPARK_EXECUTOR_CORES","Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS","Global.SPARK_EXECUTOR_MEMORY","Global.SPARK_LOCALITY_WAIT","Global.SPARK_LOCAL_PATH","Global.SPARK_MEMORY_FRACTION","Global.SPARK_TASK_MAX_FAILURES","SFTP_CONN_STRING"],"udfsToRegister":[],"udafsToRegister":[],"mesosRole":"","marathonDeploymentSettings":{"gracePeriodSeconds":"240","intervalSeconds":"20","timeoutSeconds":"20","maxConsecutiveFailures":"3","forcePullImage":true,"privileged":false,"userEnvVariables":[],"userLabels":[]},"enableQualityRules":true},"streamingSettings":{"window":"2s","blockInterval":"100ms","checkpointSettings":{"checkpointPath":"sparta/checkpoint","enableCheckpointing":true,"autoDeleteCheckpoint":true,"addTimeToCheckpointPath":false}},"sparkSettings":{"master":"mesos://zk://master.mesos:2181/mesos","sparkKerberos":true,"sparkDataStoreTls":true,"sparkMesosSecurity":true,"submitArguments":{"userArguments":[],"deployMode":"client","driverJavaOptions":"{{{Global.SPARK_DRIVER_JAVA_OPTIONS}}}"},"sparkConf":{"sparkResourcesConf":{"coresMax":"{{{Global.SPARK_CORES_MAX}}}","executorMemory":"{{{Global.SPARK_EXECUTOR_MEMORY}}}","executorCores":"{{{Global.SPARK_EXECUTOR_CORES}}}","driverCores":"{{{Global.SPARK_DRIVER_CORES}}}","driverMemory":"{{{Global.SPARK_DRIVER_MEMORY}}}","mesosExtraCores":"","localityWait":"{{{Global.SPARK_LOCALITY_WAIT}}}","taskMaxFailures":"{{{Global.SPARK_TASK_MAX_FAILURES}}}","sparkMemoryFraction":"{{{Global.SPARK_MEMORY_FRACTION}}}","sparkParallelism":""},"sparkHistoryServerConf":{"enableHistoryServerMonitoring":false,"sparkHistoryServerEventLogRotateEnable":false,"sparkHistoryServerEventLogRotateNum":"9","sparkHistoryServerEventLogRotateSize":"512"},"userSparkConf":[],"coarse":true,"sparkUser":"","sparkLocalDir":"{{{Global.SPARK_LOCAL_PATH}}}","sparkKryoSerialization":false,"sparkSqlCaseSensitive":true,"logStagesProgress":false,"hdfsTokenCache":true,"executorExtraJavaOptions":"{{{Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS}}}"}},"errorsManagement":{"genericErrorManagement":{"whenError":"Error"},"transformationStepsManagement":{"whenError":"Error","whenRowError":"RowError","whenFieldError":"FieldError"},"transactionsManagement":{"sendToOutputs":[],"sendStepData":false,"sendPredecessorsData":true,"sendInputData":true}}},"pipelineGraph":{"nodes":[{"name":"in_Row_paths","stepType":"Input","className":"RowGeneratorInputStep","classPrettyName":"RowGenerator","arity":["NullaryToNary"],"description":"Gets source and destination paths.","uiConfiguration":{"position":{"x":124.0,"y":124.0}},"configuration":{"rows":[{"fields":[{"fieldName":"source","fieldValue":"{{{SFTP_CONN_STRING}}}/gts/onetrade/Onboarding/{{{COUNTRY}}}/original/onboarding{{{COUNTRY}}}{{{DATE}}}.json","type":"string"},{"fieldName":"destination","fieldValue":"hdfs://gts-hdfs/gts/data/raw/unformatted/onetrade/onboarding/{{{COUNTRY}}}/original","type":"string"}]}],"debugOptions":"{\"query\":\"select 'sftp://rpalacios2:Stratio%4019@10.0.0.5/gts/onetrade/testOnboarding/{{{COUNTRY}}}/onboarding{{{COUNTRY}}}{{{DATE}}}.json' as source, \\n'hdfs://gts-hdfs/gts/data/raw/onetrade/unformatted/{{{COUNTRY}}}' as destination from table1 limit 1\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[{"saveMode":"Append","outputStepName":"out_FU_copy","tableName":"","discardTableName":"","extraOptions":{"saveMode":"Append"}}],"errorTableName":""},{"name":"out_FU_copy","stepType":"Output","className":"FileUtilsOutputStep","classPrettyName":"FileUtils","arity":["NullaryToNullary","NaryToNullary"],"description":"Copy json from source to destination. NFS to RU /original.","uiConfiguration":{"position":{"x":495.7940673828125,"y":125.0}},"configuration":{"fileActionsOnComplete":"[]","inputBinary":"{\"inputBinaryField\":\"\",\"inputBinaryDestinationPath\":\"\",\"inputBinaryDestinationField\":\"\",\"errorPolicy\":\"Error\"}","inputFromDataframe":"{\"inputDataframeAction\":\"COPY\",\"inputDataframeField\":\"source\",\"inputDataframeDestination\":\"destination\",\"deleteDestinationBeforeFromDataframe\":false,\"addTimestampToFilenameFromDataframe\":false,\"errorPolicy\":\"Error\"}","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[],"outputsWriter":[]},{"name":"in_Row_paths_1","stepType":"Input","className":"RowGeneratorInputStep","classPrettyName":"RowGenerator","arity":["NullaryToNary"],"description":"Gets source and destination paths.","uiConfiguration":{"position":{"x":119.6998256265905,"y":273.8126737149877}},"configuration":{"rows":[{"fields":[{"fieldName":"source","fieldValue":"{{{SFTP_CONN_STRING}}}/gts/onetrade/Onboarding/{{{COUNTRY}}}/original/onboarding{{{COUNTRY}}}{{{DATE}}}.json","type":"string"},{"fieldName":"destination","fieldValue":"hdfs://gts-hdfs/gts/data/raw/unformatted/onetrade/onboarding/{{{COUNTRY}}}/original/backup/onboarding{{{COUNTRY}}}{{{DATE}}}.json","type":"string"}]}],"debugOptions":"{\"query\":\"select 'sftp://rpalacios2:Stratio%4019@10.0.0.5/gts/onetrade/testOnboarding/{{{COUNTRY}}}/onboarding{{{COUNTRY}}}{{{DATE}}}.json' as source, \\n'hdfs://gts-hdfs/gts/data/raw/onetrade/unformatted/{{{COUNTRY}}}' as destination from table1 limit 1\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[{"saveMode":"Append","outputStepName":"out_FU_copy_1","tableName":"","discardTableName":"","extraOptions":{"saveMode":"Append"}}],"errorTableName":""},{"name":"out_FU_copy_1","stepType":"Output","className":"FileUtilsOutputStep","classPrettyName":"FileUtils","arity":["NullaryToNullary","NaryToNullary"],"description":"Copy json from source to destination. NFS to RU /original/backup. With timestamp.","uiConfiguration":{"position":{"x":486.69610248205925,"y":274.8126737149877}},"configuration":{"fileActionsOnComplete":"[]","inputBinary":"{\"inputBinaryField\":\"\",\"inputBinaryDestinationPath\":\"\",\"inputBinaryDestinationField\":\"\",\"errorPolicy\":\"Error\"}","inputFromDataframe":"{\"inputDataframeAction\":\"COPY\",\"inputDataframeField\":\"source\",\"inputDataframeDestination\":\"destination\",\"deleteDestinationBeforeFromDataframe\":false,\"addTimestampToFilenameFromDataframe\":true,\"errorPolicy\":\"Error\"}","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[],"outputsWriter":[]}],"edges":[{"origin":"in_Row_paths","destination":"out_FU_copy","dataType":"ValidData"},{"origin":"in_Row_paths_1","destination":"out_FU_copy_1","dataType":"ValidData"}],"annotations":[{"date":1579010551779,"author":"mirellaruiz","messages":[{"text":"COPIA EL JSON DESDE EL NFS A RAW UNFORMATTED","author":"mirellaruiz","date":1579010569457}],"color":"#0f1b27","position":{"x":353.1910600825706,"y":126.681204249984}},{"date":1579255942453,"author":"mirellaruiz","messages":[{"text":"Hacemos un backup del original por si acaso se sobreescribiese al mandar otro, en la carpteta /original/backup, le asociamos un timestamp","author":"mirellaruiz","date":1579255967040}],"color":"#0f1b27","position":{"x":364.38584513073675,"y":363.3709452683544}}]},"executionEngine":"Batch","uiSettings":{"position":{"x":125.15275640035705,"y":112.78736430092056,"k":0.625291148501925}},"creationDate":"2020-02-03T08:40:38Z","lastUpdateDate":"2020-02-03T08:39:16Z","version":0,"group":{"id":"ab7361e4-761c-4883-afc8-b071f068f0dd","name":"/home/qa/onetrade-ot/onboarding-ob/raw/v1"},"debugMode":false,"versionSparta":"2.11.1-7a22d44","groupId":"ab7361e4-761c-4883-afc8-b071f068f0dd"}