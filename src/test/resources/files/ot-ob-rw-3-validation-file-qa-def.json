{"id":"53c71108-effb-430d-bb08-bf758b2bdee9","name":"ot-ob-rw-3-validation-file-qa-def","description":"Validates every register and send the logs to Kafka.","settings":{"global":{"executionMode":"marathon","userPluginsJars":[],"preExecutionSqlSentences":[],"postExecutionSqlSentences":[],"addAllUploadedPlugins":true,"mesosConstraint":"spark:true","mesosConstraintOperator":"LIKE","parametersLists":["Environment"],"parametersUsed":["COUNTRY","DATE","Environment.KAFKA_BROKER_HOST_0","Environment.KAFKA_BROKER_HOST_1","Environment.KAFKA_BROKER_HOST_2","Environment.KAFKA_BROKER_PORT","Environment.POSTGRE_ASINC_MS_ONBOARDING","Global.SPARK_CORES_MAX","Global.SPARK_DRIVER_CORES","Global.SPARK_DRIVER_JAVA_OPTIONS","Global.SPARK_DRIVER_MEMORY","Global.SPARK_EXECUTOR_CORES","Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS","Global.SPARK_EXECUTOR_MEMORY","Global.SPARK_LOCALITY_WAIT","Global.SPARK_LOCAL_PATH","Global.SPARK_MEMORY_FRACTION","Global.SPARK_TASK_MAX_FAILURES"],"udfsToRegister":[],"udafsToRegister":[],"mesosRole":"","marathonDeploymentSettings":{"gracePeriodSeconds":"240","intervalSeconds":"20","timeoutSeconds":"20","maxConsecutiveFailures":"3","forcePullImage":true,"privileged":false,"userEnvVariables":[],"userLabels":[],"logLevel":""},"enableQualityRules":true},"streamingSettings":{"window":"2s","blockInterval":"100ms","checkpointSettings":{"checkpointPath":"sparta/checkpoint","enableCheckpointing":true,"autoDeleteCheckpoint":true,"addTimeToCheckpointPath":false}},"sparkSettings":{"master":"mesos://zk://master.mesos:2181/mesos","sparkKerberos":true,"sparkDataStoreTls":true,"sparkMesosSecurity":true,"submitArguments":{"userArguments":[],"deployMode":"client","driverJavaOptions":"{{{Global.SPARK_DRIVER_JAVA_OPTIONS}}}"},"sparkConf":{"sparkResourcesConf":{"coresMax":"{{{Global.SPARK_CORES_MAX}}}","executorMemory":"{{{Global.SPARK_EXECUTOR_MEMORY}}}","executorCores":"{{{Global.SPARK_EXECUTOR_CORES}}}","driverCores":"{{{Global.SPARK_DRIVER_CORES}}}","driverMemory":"{{{Global.SPARK_DRIVER_MEMORY}}}","mesosExtraCores":"","localityWait":"{{{Global.SPARK_LOCALITY_WAIT}}}","taskMaxFailures":"{{{Global.SPARK_TASK_MAX_FAILURES}}}","sparkMemoryFraction":"{{{Global.SPARK_MEMORY_FRACTION}}}","sparkParallelism":""},"sparkHistoryServerConf":{"enableHistoryServerMonitoring":false,"sparkHistoryServerEventLogRotateEnable":false,"sparkHistoryServerEventLogRotateNum":"9","sparkHistoryServerEventLogRotateSize":"512"},"userSparkConf":[],"coarse":true,"sparkUser":"","sparkLocalDir":"{{{Global.SPARK_LOCAL_PATH}}}","sparkKryoSerialization":false,"sparkSqlCaseSensitive":true,"logStagesProgress":false,"hdfsTokenCache":true,"executorExtraJavaOptions":"{{{Global.SPARK_EXECUTOR_EXTRA_JAVA_OPTIONS}}}"}},"errorsManagement":{"genericErrorManagement":{"whenError":"Error"},"transformationStepsManagement":{"whenError":"Error","whenRowError":"RowError","whenFieldError":"FieldError"},"transactionsManagement":{"sendToOutputs":[],"sendStepData":false,"sendPredecessorsData":true,"sendInputData":true}}},"pipelineGraph":{"nodes":[{"name":"in_JSON_onboarding","stepType":"Input","className":"JsonInputStep","classPrettyName":"Json","arity":["NullaryToNary"],"description":"Onboarding json to intake","uiConfiguration":{"position":{"x":-3074.074981689453,"y":1192.54116249057}},"configuration":{"path":"/gts/data/raw/formatted/onetrade/onboarding/{{{COUNTRY}}}/original/onboarding{{{COUNTRY}}}{{{DATE}}}/","inputOptions":"[]","debugOptions":"{\"fileUploaded\":\"hdfs:///user/gts-sparta/sparta/mockData/onboardingSPAIN20200127params.json\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Expl_Identificadorlc","stepType":"Transformation","className":"ExplodeTransformStep","classPrettyName":"Explode","arity":["UnaryToNary"],"description":"Obtain a struct for every Identificadorlegalcustomer","uiConfiguration":{"position":{"x":-2853.1861801697532,"y":1195.3115695659171}},"configuration":{"explodedField":"Identificador_legal_customer","inputSchemas":"[]","errorTableName":"","fieldsPreservationPolicy":"REPLACE","inputField":"customer"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"in_XD_raw_ref_countries","stepType":"Input","className":"SQLInputStepBatch","classPrettyName":"SQL","arity":["NullaryToNary"],"description":"ISO Countries Input from XDATA.","uiConfiguration":{"position":{"x":-2732.730457769474,"y":702.2483102332549}},"configuration":{"query":"select distinct iso2 from GTS_ONETRADE.raw_ref_countries WHERE iso2 is not null ","debugOptions":"{\"query\":\"--select iso2 from GTS.iso_paises_LANDING WHERE iso2 = \\\"ES\\\" limit 10\\nselect \\\"UK\\\" as iso2 \\nUNION\\nselect \\\"ES\\\" as iso2 \\nlimit 2\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Jo_KOCountry","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"QR,\nCountry field without ISO format","uiConfiguration":{"position":{"x":-1768.506428770416,"y":700.867728891566}},"configuration":{"rightTable":"in_XD_raw_ref_countries","leftTable":"Col_params","inputSchemas":"[]","joinConditions":[{"leftField":"Identificador_legal_customer.country","rightField":"iso2"}],"errorTableName":"","joinType":"LEFT_ONLY","joinReturn":"LEFT"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"in_XD_raw_ref_bics","stepType":"Input","className":"SQLInputStepBatch","classPrettyName":"SQL","arity":["NullaryToNary"],"description":"Reference bics input from XDATA.","uiConfiguration":{"position":{"x":-2747.340866331538,"y":819.3392558486289}},"configuration":{"query":"select concat(BIC_CODE,BRANCH_CODE) as BIC_CODE from GTS_ONETRADE.raw_ref_bics","debugOptions":"{\"query\":\"--select concat(BIC_CODE,BRANCH_CODE) AS BIC_CODE from GTS.raw_ref_bics  limit 10\\nselect \\\"BSCHESMMXXX\\\"  as BIC_CODE limit 1\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Jo_KOBic","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"QR, Agent field without BIC 11 chars format discarted.","uiConfiguration":{"position":{"x":-1766.861569221694,"y":817.5222006809154}},"configuration":{"rightTable":"in_XD_raw_ref_bics","leftTable":"Col_params","inputSchemas":"[]","joinConditions":[{"leftField":"Identificador_legal_customer.agent","rightField":"BIC_CODE"}],"errorTableName":"","joinType":"LEFT_ONLY","joinReturn":"LEFT"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Col_params","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"AÃ±ade:\ngts_id,\ntrace_id,\ncountry,\ndate,\ntimeOfIntake (will be the time of Validation)","uiConfiguration":{"position":{"x":-2593.1500865095145,"y":1191.8072122055469}},"configuration":{"sql":"SELECT  *,\n  Identificador_legal_customer.traceId as trace_id,\n  '{{{COUNTRY}}}' as param_country,\n  '{{{DATE}}}' as param_date\nFROM Expl_Identificadorlc\n\n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_CompanyCountryUser","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"Select the fields that must be unique to search the duplicates.","uiConfiguration":{"position":{"x":-2597.5497361815046,"y":537.6737241916535}},"configuration":{"sql":"SELECT \n\tIdentificador_legal_customer.companyId,\n\tIdentificador_legal_customer.country, \n\tIdentificador_legal_customer.internalRepresentUser,\n\ttrace_id\nFROM \n\tCol_params\n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Fil_KODuplicated","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"Select the repeated data in the file using:\nIndentificador_legal_customer\nCountry\ninternalRepresentUser","uiConfiguration":{"position":{"x":-2271.6997892057966,"y":533.5573396854279}},"configuration":{"sql":"SELECT \n\tDISTINCT trace_id, companyId, country, internalRepresentUser\nFROM \n\tSel_CompanyCountryUser\nWHERE CONCAT(companyId, country, internalRepresentUser) IN (\n  SELECT \n\tCONCAT(companyId, country, internalRepresentUser)\nFROM \n  Sel_CompanyCountryUser\n WHERE\n  \t companyId IS NOT NULL\n \t AND country IS NOT NULL\n  \t AND internalRepresentUser IS NOT NULL\nGROUP BY companyId,country,internalRepresentUser\nHAVING count(CONCAT(companyId, country,internalRepresentUser)) > 1\n)\n\n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Jo_KODuplicated","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"QR, repeated data in the same file by fields:\nCountry\nIdentifierLegalCustomer\ninternalRepresentUser","uiConfiguration":{"position":{"x":-1772.4865628874372,"y":533.3640642337677}},"configuration":{"rightTable":"Fil_KODuplicated","leftTable":"Col_params","inputSchemas":"[]","joinConditions":[{"leftField":"Identificador_legal_customer.companyId","rightField":"companyId"},{"leftField":"Identificador_legal_customer.country","rightField":"country"},{"leftField":"Identificador_legal_customer.internalRepresentUser","rightField":"internalRepresentUser"}],"errorTableName":"","joinType":"INNER","joinReturn":"LEFT"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Jo_KOExists","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"QR, data that has been previously checked as OK. By fields:\nCountry\nidentifierLegalCustomer\ninternalRepresentUser","uiConfiguration":{"position":{"x":-1766.964719531432,"y":965.146966974381}},"configuration":{"rightTable":"Jo_OKinput","leftTable":"Col_params","inputSchemas":"[]","joinConditions":[{"leftField":"Identificador_legal_customer.companyGlobalId","rightField":"company_global_id"},{"leftField":"Identificador_legal_customer.country","rightField":"country_id"},{"leftField":"Identificador_legal_customer.internalRepresentUser","rightField":"internal_represent_user"}],"errorTableName":"","joinType":"INNER","joinReturn":"LEFT"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Jo_KOtraceId","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"QR, traceID identically for different fields (Country, identifierLegalCustomer, internalRepresentUser): SHA-256 COLISION","uiConfiguration":{"position":{"x":-1388.1190925399196,"y":1103.4643449086243}},"configuration":{"rightTable":"Fil_InProgress_traceId","leftTable":"Un_Onboarding_traceId","inputSchemas":"[]","joinReturnColumns":[{"tableSide":"LEFT","column":"trace_id","alias":""}],"joinConditions":[{"leftField":"trace_id","rightField":"trace_id"}],"errorTableName":"","joinType":"INNER","joinReturn":"COLUMNS"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Un_KOtraceid","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"description":"Union KOs traceId and their reason.","uiConfiguration":{"position":{"x":-60.78058782728294,"y":971.3839311146774}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Sel_KOCountry","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Register the event in the HDFS ('CountryISO'  error).","uiConfiguration":{"position":{"x":-1452.3255846044694,"y":704.9218889736358}},"configuration":{"selectType":"EXPRESSION","selectExp":"'Domain_country' as internal_status,\ntrace_id\n\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_KOBic","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Register the event in the HDFS ('BIC'  error).","uiConfiguration":{"position":{"x":-1457.7141412845435,"y":818.6511254504171}},"configuration":{"selectType":"EXPRESSION","selectExp":"'Domain_agent' as internal_status,\ntrace_id\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_KODuplicated","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Register the event in the HDFS ('Duplicated'  error).","uiConfiguration":{"position":{"x":-1460.517461301883,"y":532.4773436490203}},"configuration":{"selectType":"EXPRESSION","selectExp":"'Duplicated' as internal_status,\ntrace_id\n\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_KOExists","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Register the event in the HDFS ('Exists'  error).","uiConfiguration":{"position":{"x":-1467.7089144578185,"y":962.4120520076904}},"configuration":{"selectType":"EXPRESSION","selectExp":"'Exists' as internal_status,\ntrace_id\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Expl_DocumentsLegalCustomer","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"We explode identificationDocumentsLegalCustomer for every Identificadorlegalcustomer","uiConfiguration":{"position":{"x":-1810.9996699867515,"y":1622.0908641983879}},"configuration":{"selectType":"EXPRESSION","selectExp":"select explode(Identificador_legal_customer.documentList),\ntrace_id\n\n\n\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Expl_AddressLegalCustomer","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"We explode customerLegalAddresses for every Identificadorlegalcustomer","uiConfiguration":{"position":{"x":-1815.9434810065977,"y":1759.7883667735246}},"configuration":{"selectType":"EXPRESSION","selectExp":"select explode(Identificador_legal_customer.addressList),\ntrace_id\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Fil_QRDocumentsLegalCustomer","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"QR_1: Null_document_documentType\nQR_2: Null_document_documentNumber\nQR_3: Domain_document_documentType\ndocumentType = 7\n7 - TAX ID\n8 - CRN\n","uiConfiguration":{"position":{"x":-1562.4164820700298,"y":1621.071282642477}},"configuration":{"sql":"SELECT\n\t'Null_document_documentType' as internal_status,\n\ttrace_id\nFROM\n\tExpl_DocumentsLegalCustomer\nWHERE\n\tcol.documentType is null\nUNION\nSELECT\n\t'Null_document_documentNumber' as internal_status,\n\ttrace_id\nFROM\n\tExpl_DocumentsLegalCustomer\nWHERE\n\tcol.documentNumber is null\nUNION\nSELECT\n\t'Domain_document_documentType' as internal_status,\n\ttrace_id\nFROM\n\tExpl_DocumentsLegalCustomer\nWHERE\n\tcol.documentType <> 7","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Fil_QRAddressLegalCustomer","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"QR_1: Domain_address_addressType\naddressType in (HOME,WORK,TAX,CORRESPONDENCE)\nQR_2: Null_address_addressType\nQR_3: Null_address_streetBuilding\nQR_4: Null_address_postCodeId\nQR_5: Null_address_townName\nQR_6: Null_address_country","uiConfiguration":{"position":{"x":-1554.8805659548543,"y":1758.7981983184782}},"configuration":{"sql":"SELECT\n\t'Domain_address_addressType' as internal_status,\n\ttrace_id\nFROM\n\tExpl_AddressLegalCustomer\nWHERE\n\tcol.addressType \n\t\tnot in (\"HOME\",\"WORK\",\"TAX\",\"CORRESPONDENCE\")\nUNION\nSELECT\n\t'Null_address_addressType' as internal_status,\n\ttrace_id\nFROM\n\tExpl_AddressLegalCustomer\nWHERE\n\tcol.addressType is null \nUNION\nSELECT\n\t'Null_address_streetName' as internal_status,\n\ttrace_id\nFROM\n\tExpl_AddressLegalCustomer\nWHERE\n\tcol.streetName is null \nUNION\nSELECT\n\t'Null_address_streetBuilding' as internal_status,\n\ttrace_id\nFROM\n\tExpl_AddressLegalCustomer\nWHERE\n\tcol.streetBuildingId is null \nUNION\nSELECT\n\t'Null_address_postCodeId' as internal_status,\n\ttrace_id\nFROM\n\tExpl_AddressLegalCustomer\nWHERE\n\tcol.postCodeId is null \nUNION\nSELECT\n\t'Null_address_townName' as internal_status,\n\ttrace_id\nFROM\n\tExpl_AddressLegalCustomer\nWHERE\n\tcol.townName is null \n\tUNION\nSELECT\n\t'Null_address_country' as internal_status,\n\ttrace_id\nFROM\n\tExpl_AddressLegalCustomer\nWHERE\n\tcol.country is null \n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Sel_LegalCustomer","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"select columns to intake LegalCustomer target ","uiConfiguration":{"position":{"x":-1994.4147622932396,"y":1905.2392714634125}},"configuration":{"selectType":"EXPRESSION","selectExp":"Identificador_legal_customer.country,\nIdentificador_legal_customer.agent,\nIdentificador_legal_customer.entity,\nIdentificador_legal_customer.companyId,\nIdentificador_legal_customer.companyName,\nIdentificador_legal_customer.tradeName,\nIdentificador_legal_customer.companyStartDate,\nIdentificador_legal_customer.companyEndDate,\nIdentificador_legal_customer.companyType,\nIdentificador_legal_customer.companyAdditionalDetail,\nIdentificador_legal_customer.countryIncorporation,\ntrace_id\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Fil_QRLegalCustomer","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"QR_1: Null_country\nQR_2: Null_agent\nQR_3: Null_entity\nQR_4: Null_companyName\nQR_5: Null_companyId\nQR_6:Format_companyStartDate\nISO 8601 'YYYY-MM-DD'\nQR_7:Format_companyEndDate\nISO 8601 'YYYY-MM-DD'\nQR_8:Domain_countryIncorporation\nISO 3166-alpha 2 \nQR_9:Domain_companyType\nISIC codes reference\n-- pending isic code description\n\n","uiConfiguration":{"position":{"x":-1539.4156778205834,"y":1905.8863051548187}},"configuration":{"sql":"  SELECT\n\t  'Null_country' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_LegalCustomer\n   WHERE\n\t  country IS NULL \nUNION \n  SELECT\n\t  'Null_agent' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_LegalCustomer\n   WHERE\n\t  agent IS NULL \nUNION\n  SELECT\n\t  'Null_entity' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_LegalCustomer\n   WHERE\n\t  entity IS NULL \nUNION\n  SELECT\n\t  'Null_companyName' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_LegalCustomer\n   WHERE\n\t  companyName IS NULL \nUNION\n  SELECT\n\t  'Null_companyId' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_LegalCustomer\n   WHERE\n\t  companyId IS NULL \nUNION\n  SELECT\n\t  'Format_companyStartDate' as internal_status,\n\t  trace_id\n  FROM\n\t  Sel_LegalCustomer\n  WHERE\n\t  companyStartDate IS NOT NULL AND\n\t  companyStartDate NOT rlike '^([0-9]{4})\\-(0[1-9]|1[012])\\-(0[1-9]|[12][0-9]|3[01])$'\nUNION\n  SELECT\n\t  'Format_companyEndDate' as internal_status,\n\t  trace_id\n  FROM\n\t  Sel_LegalCustomer\n  WHERE\n\t  companyEndDate IS NOT NULL AND\n\t  companyEndDate NOT rlike '^([0-9]{4})\\-(0[1-9]|1[012])\\-(0[1-9]|[12][0-9]|3[01])$'\nUNION\n  SELECT\n\t  'Domain_countryIncorporation' as internal_status,\n\t  trace_id\n  FROM\n\t  Sel_LegalCustomer\n  WHERE\n\t  countryIncorporation IS NOT NULL AND\n\t  countryIncorporation NOT IN (\n\t\tSELECT iso2 FROM in_XD_raw_ref_countries)\nUNION\n  SELECT\n\t  'Domain_companyType' as internal_status,\n\t  trace_id\n  FROM\n\t  Sel_LegalCustomer\n  WHERE\n\t  companyType IS NOT NULL AND\n\t  companyType NOT IN (\n\t\tSELECT code FROM in_XD_raw_ref_isic_code)\n\t\t\t  \n\n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Expl_ContactListLegalCustomer","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"We explode contactsListLegalCustomer for every Identificadorlegalcustomer","uiConfiguration":{"position":{"x":-1807.1228921760521,"y":2035.5112442344835}},"configuration":{"selectType":"EXPRESSION","selectExp":"select explode(Identificador_legal_customer.contactList),\ntrace_id\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_UserLegalCustomer","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"select columns to intake UserLegalCustomer target","uiConfiguration":{"position":{"x":-1801.2452015155377,"y":2166.476409056079}},"configuration":{"selectType":"EXPRESSION","selectExp":"Identificador_legal_customer.firstName,\nIdentificador_legal_customer.lastName,\nIdentificador_legal_customer.documentType,\nIdentificador_legal_customer.countryDocument,\nIdentificador_legal_customer.documentNumber,\nIdentificador_legal_customer.cmc,\nIdentificador_legal_customer.internalRepresentUser,\nIdentificador_legal_customer.contactDataMail,\nIdentificador_legal_customer.contactDataMOBI,\nIdentificador_legal_customer.relationshipType,\nIdentificador_legal_customer.typeDisposition,\ntrace_id\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Expl_AccountLegalCustomer","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"uiConfiguration":{"position":{"x":-1772.3471225731591,"y":2308.951139401023}},"configuration":{"selectType":"EXPRESSION","selectExp":"select explode(Identificador_legal_customer.accountsList),\ntrace_id","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Fil_QRContactListLegalCustomer","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"QR_1:Domain_contacts_contactType\ncontactType  NOT IN ('PHON','MAIL','MOBI','SNET')","uiConfiguration":{"position":{"x":-1548.8037393440209,"y":2035.6775649204437}},"configuration":{"sql":"  SELECT\n\t  'Domain_contactType' as internal_status,\n\t  trace_id\n   FROM\n\t  Expl_ContactListLegalCustomer\n  WHERE\n\t  col.contactType  NOT IN ('PHON','MAIL','MOBI','SNET')\n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Fil_QRUserLegalCustomer","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"QR_1:Null_firstName\nQR_2:Null_lastName\nQR_3:Null_documentType\nQR_4:Null_countryDocument\nQR_5:Null_documentNumber\nQR_6:Null_cmc\nQR_7:Null_internalRepresentUser\nQR_8:Null_contactDataMail\nQR_9:Null_contactDataMOBI\nQR_10:Domain_documentType\nPossible values are:\n1 = National ID card \n2 = Passport \n3 = Child's ID card \n4 = Social Security Nymber\n5 = Foreign resident ID card\n6 = Driving License Number\n7 = Tax ID\nQR_11:Domain_typeDisposition\n","uiConfiguration":{"position":{"x":-1553.806044060353,"y":2168.6736519610563}},"configuration":{"sql":"  SELECT\n\t  'Null_firstName' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  firstName IS NULL \nUNION \n  SELECT\n\t  'Null_lastName' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  lastName IS NULL \nUNION \n   SELECT\n\t  'Null_documentType' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  documentType IS NULL \nUNION \n   SELECT\n\t  'Null_countryDocument' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  countryDocument IS NULL \nUNION \n   SELECT\n\t  'Null_documentNumber' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  documentNumber IS NULL \nUNION \n   SELECT\n\t  'Null_cmc' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  cmc IS NULL \nUNION \n   SELECT\n\t  'Null_internalRepresentUser' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  internalRepresentUser IS NULL \nUNION \n   SELECT\n\t  'Null_contactDataMail' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  contactDataMail IS NULL \nUNION \n   SELECT\n\t  'Null_contactDataMOBI' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  contactDataMOBI IS NULL \nUNION \n   SELECT\n\t  'Domain_documentType' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  documentType not between 1 and 7\nUNION \n   SELECT\n\t  'Domain_typeDisposition' as internal_status,\n\t  trace_id\n   FROM\n\t  Sel_UserLegalCustomer\n   WHERE\n\t  typeDisposition not in (\"JOINT\",\"SINGLE\")","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Fil_QRAccountLegalCustomer","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"QR_1:Domain_accountType\nPossible values are:\nIBA - IBAN format\nBBA - Local format\nTXT - Other format\n\n\n","uiConfiguration":{"position":{"x":-1556.4764639668356,"y":2306.78488305987}},"configuration":{"sql":"  SELECT\n\t  'Domain_account_accountType' as internal_status,\n\t  trace_id\n   FROM\n\t  Expl_AccountLegalCustomer\n   WHERE\n\t  col.accountType not in ('BBA','IBA','TXT') \n  UNION\n    SELECT\n\t  'Format_account_accountId' as internal_status,\n\t  trace_id\n   FROM\n\t  Expl_AccountLegalCustomer\n   WHERE\n\t  length(col.accountId) > 35 \n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Jo_OKDuplicated_traceId","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"Seleccionamos los traceId de datos no duplicados, para ver posteriormente si hay colisiÃ³n por traceId.","uiConfiguration":{"position":{"x":-1892.8274710118267,"y":1407.7479116375678}},"configuration":{"rightTable":"Fil_KODuplicated","leftTable":"Col_params","inputSchemas":"[]","joinReturnColumns":[{"tableSide":"LEFT","column":"\ttrace_id","alias":""}],"joinConditions":[{"leftField":"\ttrace_id","rightField":"trace_id"}],"errorTableName":"","joinType":"LEFT_ONLY","joinReturn":"COLUMNS"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Sel_KODuplicated_traceId","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Seleccionamos los traceId duplicados.","uiConfiguration":{"position":{"x":-1893.601911155328,"y":1301.8531911956818}},"configuration":{"selectType":"EXPRESSION","selectExp":"trace_id","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Un_Onboarding_traceId","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"description":"Todos los traceId unicos del fichero a onbordear.","uiConfiguration":{"position":{"x":-1643.9370746926934,"y":1367.554867948586}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Sel_onboarding_KOtraceId","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"Seleccionamos los traceId que colisionan en el fichero onboarding.","uiConfiguration":{"position":{"x":-1359.4951801614434,"y":1367.5549900188985}},"configuration":{"sql":"SELECT \n\tDISTINCT trace_id\nFROM \n\tUn_Onboarding_traceId\nWHERE trace_id IN (\n  SELECT \n\ttrace_id \nFROM \n  Un_Onboarding_traceId\nGROUP BY trace_id\nHAVING count(trace_id) > 1\n)\n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Un_KOtraceId","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"description":"Colision por traceId.","uiConfiguration":{"position":{"x":-1123.227538043569,"y":1151.3424432637273}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Sel_KOtraceId","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Register the event in the HDFS ('traceIdColision'  error).","uiConfiguration":{"position":{"x":-912.7020856867289,"y":1148.8974710646453}},"configuration":{"selectType":"EXPRESSION","selectExp":"'traceIdColision' as internal_status,\ntrace_id\n\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_ProcessLogKO","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Register the event in the HDFS ('In_Progress'  status, \"NA\", error).","uiConfiguration":{"position":{"x":318.8121246360197,"y":970.8867894600799}},"configuration":{"selectType":"EXPRESSION","selectExp":"'Data' as step, \n'KO' as status,\nnull as log,\n'QA' as error,\n internal_status as qa_error,\nnull as description,\n trace_id\n\n\n\n\n\n\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Jo_OKtraceId","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"TraceId validated as OK","uiConfiguration":{"position":{"x":121.35105640215124,"y":1227.8974078529877}},"configuration":{"rightTable":"Un_KOtraceid","leftTable":"Col_params","inputSchemas":"[]","joinReturnColumns":[{"tableSide":"LEFT","column":"trace_id","alias":""}],"joinConditions":[{"leftField":"trace_id","rightField":"trace_id"}],"errorTableName":"","joinType":"LEFT_ONLY","joinReturn":"COLUMNS"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_ProcessLogOK","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Register the event in the HDFS ('In_Progress'  status, \"NA\", error).","uiConfiguration":{"position":{"x":335.89162952226843,"y":1227.8975299233002}},"configuration":{"selectType":"EXPRESSION","selectExp":"'Global_ID' as step, \n'In_progress' as status,\nnull as log,\n'NA' as error,\n\"NA\" as qa_error,\nnull as description,\n trace_id\n\n\n\n\n\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Un_processLog","stepType":"Transformation","className":"UnionTransformStep","classPrettyName":"Union","arity":["NaryToNary"],"description":"Union all logs.","uiConfiguration":{"position":{"x":536.8641027335254,"y":1104.1180418845925}},"configuration":{"inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Sel_ProcessLog","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"Select only non duplicated fields. (to avoid duplicated registers by trace id)","uiConfiguration":{"position":{"x":746.5394872550096,"y":1105.9621559261163}},"configuration":{"sql":"SELECT \ntrace_id as traceId,\ncollect_set(struct(\n      log as levelLogId,\n  \t  qa_error as errorId,\n  \t  description,\n      current_timestamp() as stepTimestamp,\n  \t  struct(status as statusId) as onboardingStatus,\n  \t  struct(step as stepId) as onboardingStep,\n   \t  struct(error as mainErrorId) as onboardingError\n)) as onboardingProcessLogs\nfrom Un_processLog\ngroup by trace_id","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Jo_OKinput","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"Already validated registers.","uiConfiguration":{"position":{"x":-2712.1680775854506,"y":962.2076297523372}},"configuration":{"rightTable":"Fil_OK_traceId","leftTable":"Sel_user","inputSchemas":"[]","joinConditions":[{"leftField":"trace_id","rightField":"trace_id"}],"errorTableName":"","joinType":"INNER","joinReturn":"LEFT"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"out_Kafka","stepType":"Output","className":"KafkaOutputStep","classPrettyName":"Kafka","arity":["NullaryToNullary","NaryToNullary"],"uiConfiguration":{"position":{"x":1787.9818243097063,"y":816.0036222057395}},"configuration":{"value.serializer.outputFormat":"JSON","errorSink":false,"buffer.memory":"33554432","tlsEnabled":true,"security.protocol":"PLAINTEXT","bootstrap.servers":[{"host":"{{{Environment.KAFKA_BROKER_HOST_0}}}","port":"{{{Environment.KAFKA_BROKER_PORT}}}"},{"host":"{{{Environment.KAFKA_BROKER_HOST_1}}}","port":"{{{Environment.KAFKA_BROKER_PORT}}}"},{"host":"{{{Environment.KAFKA_BROKER_HOST_2}}}","port":"{{{Environment.KAFKA_BROKER_PORT}}}"}],"errorTableName":"","acks":"1","key.serializer.outputFormat":"JSON","ssl.client.auth":"none","saveOptions":"[]","batch.size":"16384"},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","lineageProperties":[],"outputsWriter":[]},{"name":"Fil_OK_traceId","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"Filter OK registers. Select traceId.","uiConfiguration":{"position":{"x":-3176.9075722653856,"y":960.7082686419731}},"configuration":{"sql":"select\n\ttrace_id\n\tfrom \n\t\tin_PG_process_log\nwhere status_id = \"OK\"","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Fil_InProgress_traceId","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"Select all traceId to check that they are not being repited.","uiConfiguration":{"position":{"x":-2855.9876503903856,"y":1099.9021468158012}},"configuration":{"sql":"select\n\ttrace_id\n\tfrom \n\t\tin_PG_process_log\nwhere status_id <> \"In_progress\"","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Sel_user","stepType":"Transformation","className":"SelectTransformStep","classPrettyName":"Select","arity":["UnaryToNary"],"description":"Selects only columns needed.","uiConfiguration":{"position":{"x":-3122.776356833551,"y":790.5821608078195}},"configuration":{"selectType":"EXPRESSION","selectExp":"internal_represent_user, company_global_id, country as country_id, trace_id\n","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"in_XD_raw_ref_isic_code","stepType":"Input","className":"SQLInputStepBatch","classPrettyName":"SQL","arity":["NullaryToNary"],"description":"ISIC input. Validates the code.","uiConfiguration":{"position":{"x":-2949.5341714412057,"y":596.404080960535}},"configuration":{"query":"select code from GTS_ONETRADE.raw_ref_isic ","debugOptions":"{\"query\":\"select code from GTS_ONETRADE.raw_ref_isic limit 10\"}","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[],"errorTableName":""},{"name":"Rep_logs","stepType":"Transformation","className":"RepartitionTransformStep","classPrettyName":"Repartition","arity":[],"uiConfiguration":{"position":{"x":1424.8847682158216,"y":814.3935824519627}},"configuration":{"partitions":"1","columns":"[]","inputSchemas":"[]","errorTableName":""},"supportedEngines":["Streaming","Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[{"saveMode":"Append","outputStepName":"out_Kafka","tableName":"onboardingChange","discardTableName":"","extraOptions":{"partitionBy":"","saveMode":"Append"}}]},{"name":"in_PG_process","stepType":"Input","className":"PostgresInputStepBatch","classPrettyName":"Postgres","arity":["NullaryToNary"],"uiConfiguration":{"position":{"x":-3394.0141010762372,"y":778.9299262498198}},"configuration":{"inputOptions":"[]","url":"{{{Environment.POSTGRE_ASINC_MS_ONBOARDING}}}","debugOptions":"{\"query\":\"select\\n\\tinternal_represent_user, company_global_id, country, trace_id\\n\\tfrom \\n\\t\\tGTS_ONETRADE.onboarding_pg_user\\n\\t\\tlimit 10\"}","isolationLevel":"READ_UNCOMMITTED","tlsEnabled":true,"caseSensitiveEnabled":true,"selectInput":"TABLE","dbtable":"onetradeonboardings.onboarding_process","errorTableName":""},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"in_PG_process_log","stepType":"Input","className":"PostgresInputStepBatch","classPrettyName":"Postgres","arity":["NullaryToNary"],"uiConfiguration":{"position":{"x":-3356.9127827168622,"y":1081.9222053025542}},"configuration":{"inputOptions":"[]","url":"{{{Environment.POSTGRE_ASINC_MS_ONBOARDING}}}","debugOptions":"{\"query\":\"select * from GTS_ONETRADE.onboarding_pg_process_log limit 10\"}","isolationLevel":"READ_UNCOMMITTED","tlsEnabled":true,"caseSensitiveEnabled":true,"selectInput":"QUERY","errorTableName":"","selectExp":"Select * from onetradeonboardings.onboarding_process_log"},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Sel_process","stepType":"Transformation","className":"TriggerTransformStep","classPrettyName":"Trigger","arity":["BinaryToNary","UnaryToNary","NaryToNary"],"description":"Select process and user data.","uiConfiguration":{"position":{"x":323.3641607064137,"y":558.3682780648244}},"configuration":{"sql":"SELECT \nIdentificador_legal_customer.traceId,\nnull as globalId,\nIdentificador_legal_customer.companyGlobalId,\nIdentificador_legal_customer.country,\nconcat(\"onboarding\",param_country,param_date,\".json\") as fileName,\nIdentificador_legal_customer.companyName,\nIdentificador_legal_customer.cmc,\nIdentificador_legal_customer.internalRepresentUser,\nstruct(\"Batch\" as onboardingId) as onboardingType,\nIdentificador_legal_customer.processTimestamp\nfrom Col_params\n\n\n","discardConditions":"[]","inputSchemas":"[]","errorTableName":"","executeSqlWhenEmpty":true},"supportedEngines":["Batch"],"executionEngine":"Batch","supportedDataRelations":["ValidData","DiscardedData"],"lineageProperties":[],"outputsWriter":[]},{"name":"Jo_Logs","stepType":"Transformation","className":"JoinTransformStep","classPrettyName":"Join","arity":["BinaryToNary"],"description":"Join and then creates JSON with logs for Kafka.","uiConfiguration":{"position":{"x":1113.1309987255113,"y":817.3590417212865}},"configuration":{"rightTable":"Sel_ProcessLog","leftTable":"Sel_process","inputSchemas":"[]","joinReturnColumns":[{"tableSide":"LEFT","column":"companyGlobalId","alias":""},{"tableSide":"LEFT","column":"globalId","alias":""},{"tableSide":"LEFT","column":"traceId","alias":""},{"tableSide":"RIGHT","column":"onboardingProcessLogs","alias":""},{"tableSide":"LEFT","column":"country","alias":""},{"tableSide":"LEFT","column":"cmc","alias":""},{"tableSide":"LEFT","column":"internalRepresentUser","alias":""},{"tableSide":"LEFT","column":"fileName","alias":""},{"tableSide":"LEFT","column":"companyName","alias":""},{"tableSide":"LEFT","column":"onboardingType","alias":""},{"tableSide":"LEFT","column":"processTimestamp","alias":""}],"joinConditions":[{"leftField":"traceId","rightField":"traceId"}],"errorTableName":"","joinType":"INNER","joinReturn":"COLUMNS"},"supportedEngines":["Batch","Streaming"],"executionEngine":"Batch","supportedDataRelations":["ValidData"],"lineageProperties":[],"outputsWriter":[]}],"edges":[{"origin":"in_JSON_onboarding","destination":"Expl_Identificadorlc","dataType":"ValidData"},{"origin":"in_XD_raw_ref_countries","destination":"Jo_KOCountry","dataType":"ValidData"},{"origin":"in_XD_raw_ref_bics","destination":"Jo_KOBic","dataType":"ValidData"},{"origin":"Expl_Identificadorlc","destination":"Col_params","dataType":"ValidData"},{"origin":"Col_params","destination":"Sel_CompanyCountryUser","dataType":"ValidData"},{"origin":"Sel_CompanyCountryUser","destination":"Fil_KODuplicated","dataType":"ValidData"},{"origin":"Fil_KODuplicated","destination":"Jo_KODuplicated","dataType":"ValidData"},{"origin":"Col_params","destination":"Jo_KODuplicated","dataType":"ValidData"},{"origin":"Col_params","destination":"Jo_KOCountry","dataType":"ValidData"},{"origin":"Col_params","destination":"Jo_KOBic","dataType":"ValidData"},{"origin":"Col_params","destination":"Jo_KOExists","dataType":"ValidData"},{"origin":"Jo_KOCountry","destination":"Sel_KOCountry","dataType":"ValidData"},{"origin":"Jo_KOBic","destination":"Sel_KOBic","dataType":"ValidData"},{"origin":"Jo_KODuplicated","destination":"Sel_KODuplicated","dataType":"ValidData"},{"origin":"Jo_KOExists","destination":"Sel_KOExists","dataType":"ValidData"},{"origin":"Sel_KODuplicated","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Sel_KOCountry","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Sel_KOBic","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Sel_KOExists","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Expl_DocumentsLegalCustomer","destination":"Fil_QRDocumentsLegalCustomer","dataType":"ValidData"},{"origin":"Expl_AddressLegalCustomer","destination":"Fil_QRAddressLegalCustomer","dataType":"ValidData"},{"origin":"Sel_LegalCustomer","destination":"Fil_QRLegalCustomer","dataType":"ValidData"},{"origin":"Expl_ContactListLegalCustomer","destination":"Fil_QRContactListLegalCustomer","dataType":"ValidData"},{"origin":"Sel_UserLegalCustomer","destination":"Fil_QRUserLegalCustomer","dataType":"ValidData"},{"origin":"Expl_AccountLegalCustomer","destination":"Fil_QRAccountLegalCustomer","dataType":"ValidData"},{"origin":"Col_params","destination":"Expl_DocumentsLegalCustomer","dataType":"ValidData"},{"origin":"Col_params","destination":"Expl_AddressLegalCustomer","dataType":"ValidData"},{"origin":"Col_params","destination":"Sel_LegalCustomer","dataType":"ValidData"},{"origin":"Col_params","destination":"Expl_ContactListLegalCustomer","dataType":"ValidData"},{"origin":"Col_params","destination":"Sel_UserLegalCustomer","dataType":"ValidData"},{"origin":"Col_params","destination":"Expl_AccountLegalCustomer","dataType":"ValidData"},{"origin":"Col_params","destination":"Jo_OKDuplicated_traceId","dataType":"ValidData"},{"origin":"Fil_KODuplicated","destination":"Jo_OKDuplicated_traceId","dataType":"ValidData"},{"origin":"Fil_KODuplicated","destination":"Sel_KODuplicated_traceId","dataType":"ValidData"},{"origin":"Sel_KODuplicated_traceId","destination":"Un_Onboarding_traceId","dataType":"ValidData"},{"origin":"Jo_OKDuplicated_traceId","destination":"Un_Onboarding_traceId","dataType":"ValidData"},{"origin":"Un_Onboarding_traceId","destination":"Sel_onboarding_KOtraceId","dataType":"ValidData"},{"origin":"Un_Onboarding_traceId","destination":"Jo_KOtraceId","dataType":"ValidData"},{"origin":"Sel_onboarding_KOtraceId","destination":"Un_KOtraceId","dataType":"ValidData"},{"origin":"Jo_KOtraceId","destination":"Un_KOtraceId","dataType":"ValidData"},{"origin":"Un_KOtraceId","destination":"Sel_KOtraceId","dataType":"ValidData"},{"origin":"Sel_KOtraceId","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Fil_QRDocumentsLegalCustomer","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Fil_QRAddressLegalCustomer","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Fil_QRLegalCustomer","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Fil_QRContactListLegalCustomer","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Fil_QRUserLegalCustomer","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Fil_QRAccountLegalCustomer","destination":"Un_KOtraceid","dataType":"ValidData"},{"origin":"Un_KOtraceid","destination":"Sel_ProcessLogKO","dataType":"ValidData"},{"origin":"Un_KOtraceid","destination":"Jo_OKtraceId","dataType":"ValidData"},{"origin":"Col_params","destination":"Jo_OKtraceId","dataType":"ValidData"},{"origin":"Jo_OKtraceId","destination":"Sel_ProcessLogOK","dataType":"ValidData"},{"origin":"Sel_ProcessLogKO","destination":"Un_processLog","dataType":"ValidData"},{"origin":"Sel_ProcessLogOK","destination":"Un_processLog","dataType":"ValidData"},{"origin":"Un_processLog","destination":"Sel_ProcessLog","dataType":"ValidData"},{"origin":"Jo_OKinput","destination":"Jo_KOExists","dataType":"ValidData"},{"origin":"in_XD_raw_ref_countries","destination":"Fil_QRLegalCustomer","dataType":"ValidData"},{"origin":"Fil_OK_traceId","destination":"Jo_OKinput","dataType":"ValidData"},{"origin":"Fil_InProgress_traceId","destination":"Jo_KOtraceId","dataType":"ValidData"},{"origin":"Sel_user","destination":"Jo_OKinput","dataType":"ValidData"},{"origin":"in_XD_raw_ref_isic_code","destination":"Fil_QRLegalCustomer","dataType":"ValidData"},{"origin":"Rep_logs","destination":"out_Kafka","dataType":"ValidData"},{"origin":"in_PG_process","destination":"Sel_user","dataType":"ValidData"},{"origin":"in_PG_process_log","destination":"Fil_OK_traceId","dataType":"ValidData"},{"origin":"in_PG_process_log","destination":"Fil_InProgress_traceId","dataType":"ValidData"},{"origin":"Sel_process","destination":"Jo_Logs","dataType":"ValidData"},{"origin":"Jo_Logs","destination":"Rep_logs","dataType":"ValidData"},{"origin":"Sel_ProcessLog","destination":"Jo_Logs","dataType":"ValidData"},{"origin":"Col_params","destination":"Sel_process","dataType":"ValidData"}],"annotations":[{"date":1579011001105,"author":"mirellaruiz","messages":[{"text":"DESCARTAMOS LOS DUPLICADOS EN EL MISMO FICHERO","author":"mirellaruiz","date":1579011012011}],"color":"#ec445c","position":{"x":-1777.6371173986845,"y":505.09494732279427}},{"date":1579011018100,"author":"mirellaruiz","messages":[{"text":"DESCARTAMOS LOS QUE TIENEN EL CAMPO COUNTRY ERRONEO","author":"mirellaruiz","date":1579011036554}],"color":"#ec445c","position":{"x":-1762.5041029873207,"y":662.4316960321556}},{"date":1579011269447,"author":"mirellaruiz","messages":[{"text":"DESCARTAMOS LOS QUE TIENEN EL BIC ERRONEO (CAMPO AGENT)","author":"mirellaruiz","date":1579011296315}],"color":"#ec445c","position":{"x":-1782.9134141144796,"y":794.6897997211191}},{"date":1579607152450,"author":"mirellaruiz","messages":[{"text":"DESCARTAMOS LOS QUE YA HABIAMOS DADO COMO OK. TO BE: DESCARTAR SOLO LOS QUE YA HAYAN LLEGADO A DOMINIOS.","author":"mirellaruiz","date":1579607185778}],"color":"#ec445c","position":{"x":-1829.9234662734773,"y":942.230155236092}},{"date":1579607399631,"author":"mirellaruiz","messages":[{"text":"COLISION POR TRACE ID: \nCOMPARACION 1: LO QUE YA HABIA ALMACENADO","author":"mirellaruiz","date":1579607417137}],"color":"#ec445c","position":{"x":-1501.2709931909485,"y":1118.155890827328}},{"date":1579607690319,"author":"mirellaruiz","messages":[{"text":"COLISION POR TRACEID EN EL MISMO FICHERO","author":"mirellaruiz","date":1579607702434}],"color":"#ec445c","position":{"x":-1364.0102544329513,"y":1336.6131229351265}},{"date":1579607706846,"author":"mirellaruiz","messages":[{"text":"QR DE LOS CAMPOS: NULLS Y DOMINIOS","author":"mirellaruiz","date":1579607718826}],"color":"#ec445c","position":{"x":-1615.332757339571,"y":1574.4027630611777}},{"date":1579607728252,"author":"mirellaruiz","messages":[{"text":"SACAMOS LOS REGISTROS OK Y KO POR PARTE DE DATA","author":"mirellaruiz","date":1579607740082}],"color":"#ec445c","position":{"x":159.35577235282344,"y":1159.6590124110658}}]},"executionEngine":"Batch","uiSettings":{"position":{"x":1171.401881070112,"y":-93.85710003896907,"k":0.32344042400871964}},"creationDate":"2020-02-03T08:40:56Z","lastUpdateDate":"2020-02-03T08:39:46Z","version":0,"group":{"id":"ab7361e4-761c-4883-afc8-b071f068f0dd","name":"/home/qa/onetrade-ot/onboarding-ob/raw/v1"},"debugMode":false,"versionSparta":"2.11.1-7a22d44","groupId":"ab7361e4-761c-4883-afc8-b071f068f0dd"}